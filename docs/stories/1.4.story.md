# Story 1.4: Implement Project Restoration UI & Logic

## Story Information
- **Epic**: 1.3 - Project Archiving and Restoration
- **Story Number**: 1.3.1
- **Title**: Implement Project Restoration UI & Logic
- **Status**: Draft

## Story
As an ecological consultant, I want to restore an archived project, so that I can make it active again and continue working on it.

## Acceptance Criteria
1.  **AC1**: When viewing an archived project on the project details page (`/projects/[id]`), an "Unarchive" or "Restore" button is displayed instead of the "Archive" button.
2.  **AC2**: Clicking the "Restore" button triggers a new `unarchiveProject` action in the `ProjectManagementStore`.
3.  **AC3**: The `unarchiveProject` action updates the project's status to `active` via an API call and updates the local state.
4.  **AC4**: Upon successful restoration, a success toast notification is displayed (e.g., "Project restored successfully").
5.  **AC5**: After restoration, the project details page automatically reflects the new "Active" status and shows the "Archive" button again.
6.  **AC6**: The project now appears under the "Active" filter on the dashboard.

## Dev Notes

### Previous Story Insights
- This feature is the counterpart to the existing archive functionality. The implementation should mirror the `archiveProject` logic in the UI, state store, and API client.

### Data Models
- The story involves updating the `status` field of the `Project` schema from `'archived'` to `'active'`.
  - **Firestore Collection**: `projects`
  - **Schema Source**: `packages/shared-types/src/database/project-schema.ts`

### API Specifications
- A new API endpoint or a modification to an existing one will be needed to handle unarchiving. For now, we will assume a new `unarchiveProject` method in the `ProjectApiClient`.
  - **State Management Action**: A new `unarchiveProject(projectId)` action will be created in `apps/web/lib/stores/project-management.ts`.

### Component Specifications
- **`ProjectActions` Component**: This component in `apps/web/app/(authenticated)/projects/[id]/page.tsx` will be modified to conditionally render either the "Archive" or "Unarchive" button based on the project's `status`.
- **`ProjectManagementStore`**: The Zustand store will be updated with the new `unarchiveProject` action.

### File Locations
- **Modified Page**: `apps/web/app/(authenticated)/projects/[id]/page.tsx`
- **Modified Store**: `apps/web/lib/stores/project-management.ts`
- **Modified Test File**: `apps/web/app/(authenticated)/projects/[id]/page.test.tsx` (to be updated with unarchive tests).

### Testing Requirements
- **Unit Tests**:
    - Verify that the "Restore" button is shown for archived projects.
    - Test that the `unarchiveProject` store action is called when the button is clicked.
    - Mock success and failure scenarios for the `unarchiveProject` action and assert that the correct UI feedback (toasts, button state) is provided.

## Tasks / Subtasks

### Task 1: Update State Management (AC: 2, 3)
- [x] In `apps/web/lib/stores/project-management.ts`, create a new `unarchiveProject` action that takes a `projectId`.
- [x] This action should optimistically update the project's status in the local state to `'active'`.
- [x] It should then call a new (to be created) `unarchiveProject` method in the `ProjectApiClient`.

### Task 2: Update Project Details Page UI (AC: 1, 5)
- [x] In `apps/web/app/(authenticated)/projects/[id]/page.tsx`, modify the `ProjectActions` component.
- [x] Add a new "Restore" button, perhaps using an `ArchiveRestore` icon from `lucide-react`.
- [x] Conditionally render the "Archive" button if `project.status === 'active'` and the "Restore" button if `project.status === 'archived'`.
- [x] Wire the new button's `onClick` event to a new `handleUnarchive` function.

### Task 3: Implement `handleUnarchive` Logic (AC: 4)
- [x] In `apps/web/app/(authenticated)/projects/[id]/page.tsx`, create a `handleUnarchive` callback function.
- [x] This function should call the new `unarchiveProject` action from the Zustand store.
- [x] On success, it should display a success toast and ensure the UI updates to show the "Active" status and "Archive" button.

### Task 4: Update Unit Tests
- [x] In `apps/web/app/(authenticated)/projects/[id]/page.test.tsx`, add tests for the new unarchive functionality.
- [x] Test that the correct button is rendered based on the project's status.
- [x] Mock the `unarchiveProject` action and test the success and failure flows.

## Dev Agent Record

### File List
- `apps/web/lib/stores/project-management.ts`
- `apps/web/app/(authenticated)/projects/[id]/page.tsx`
- `apps/web/app/(authenticated)/projects/[id]/page.test.tsx`
- `apps/web/components/features/project-management/project-card.test.tsx`
- `apps/web/components/features/project-management/project-list.test.tsx`
- `apps/web/lib/stores/project-management.test.ts`
- `apps/web/jest.config.js`
- `apps/web/test-setup.ts`
- `packages/shared-types/src/index.ts`
- `apps/web/app/(authenticated)/projects/[id]/edit/page.tsx`
- `apps/web/app/(authenticated)/projects/[id]/edit/page.test.tsx`

### Completion Notes
- The linter is now passing after fixing a number of issues with the test setup. The `unarchiveProject` functionality has been added and tested.
